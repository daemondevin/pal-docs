
Topic 4.3 <i class="icon-docs"></i>

----------

**Table of Contents <i class="icon-sitemap"></i>**

[TOC]

----------

# Windows Services

## About Services
When updating an installation, it's good practice for you to stop the installed application and anything related with it before overwriting any of its files. The same goes for making PAFs. Since essentially we're _installing_ our portable everytime we launch it, we need to be sure that a locally run service (if any) is stopped before executing our portable version. Then, of course, return the host's PC with it's original service and make sure it's running on exit.

The support for services is by default disabled in the official builds of `PAL`. I'm sure they have their reasons for not allowing support for services just yet. I think there is more to it than just this but in the source code of `PAL` it's commented with:

> Currently services are disabled as:
> 
> - they're not used yet (possibly unstable) and
> - the plug-in is fairly large (at time of reporting, 122591B vs. 96901B, 25KB larger)
> 
> TODO: switch back to NSIS code... got to sort out the null byte issue with dependencies.

## Implementation
With the PA.c Launcher that I'm currently developing I have eliminated the need to use the `custom.nsh` file to work with services. You can visit the GitHub project page [here](https://github.com/demondevin/portableapps.comlauncher#features) which will take you to the features section of the read me file for more information.

### Finding Services
If you used _Total Uninstall_ to capture an installation of a program than you will be able to tell if any services were installed as well. By looking at the image to the right you can see there's two services that were installed while capturing the installation of Virtual CloneDrive; `ElbyCDIO` and `VClone`. Keep reading, we are not out of the woods yet people.


----------
![](http://softables.tk/img/docs/services.01.png)
Screenshot of the services section in *Total Uninstall*

----------

Take note to the service name(s) that are shown to you like in the image above because that will be the name(s) you'll need to use for this next part. Go ahead and open up a command prompt; we're going to be using the `sc` command to find the service(s) configuration information. In the prompt screen go ahead and enter in `sc qc ElbyCDIO` (you would repeat for the second service `VClone`). You should get something resembling the following:

```dos
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Windows\system32>sc qc ElbyCDIO
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: ElbyCDIO
        TYPE               : 1  KERNEL_DRIVER
        START_TYPE         : 1   SYSTEM_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : System32\Drivers\ElbyCDIO.sys
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : ElbyCDIO Driver
        DEPENDENCIES       :
        SERVICE_START_NAME :

C:\Windows\system32>
```

So now you have all the information you need to deal with a service using the macros below. Line 8 tells you the type of service which in this case is a kernel driver. Line 9 tells you the start type which in this case is system start. Line 11 tells you where the services' file path is located on the system. Line 15 would also tell you if there were any dependencies but in this case there isn't any.

> You would use the information with my build of [PAL](https://github.com/demondevin/portableapps.comlauncher "demon.devin's PA.c Launcher GitHub Project Page") like this:
> 
> * (Line 8) --- kernel
> * (Line 9) --- system
> * (Line 11) --- `$SYSDIR\drivers\ElbyCDIO.sys` -- Copy this file to the `PAF's` folder somewhere (*i.e.* `..\App\DefaultData\drivers`).
> * (Line 15) --- Since this is empty you wouldn't use this key.

If you're using my build of [`PAL`](https://github.com/demondevin/portableapps.comlauncher "demon.devin's PAL GitHub Project Page") to `PAF` your portable then you should have inside your `Launcher.ini` file something similiar to the code block below. You would repeat as needed for any other services, in this case `[Service2]Name=VClone` and so on.

```ini
[Service1]
Name=ElbyCDIO
Path=%PAL:DataDir%\drivers\ElbyCDIO.sys
Type=kernel
Start=system
IfExists=replace
```
> <i class="icon-info-circled"></i> **Alert:**
> Visit the official page on my website for even more content on this topic. 
> 
> - [Services on The PAF Docs](http://softables.tk/docs/advanced/services "Services | Softables.tk/")